<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
    <title>RIME | 中州韻輸入法引擎 - 狀態管理</title>
    <subtitle>Le blog de la Rime</subtitle>
    <link rel="self" type="application/atom+xml" href="https://rime.im/tags/狀態管理/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://rime.im"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2026-02-26T00:00:00+00:00</updated>
    <id>https://rime.im/tags/狀態管理/atom.xml</id>
    <entry xml:lang="zh">
        <title>如何讓 lazy_static 裏的靜態配置擁有「動態響應」能力？——記一次輸入法引擎的架構重構</title>
        <published>2026-02-26T00:00:00+00:00</published>
        <updated>2026-02-26T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              佛振@式恕堂
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://rime.im/blog/combo-jyutping-code-refactor/"/>
        <id>https://rime.im/blog/combo-jyutping-code-refactor/</id>
        
        <summary type="html">&lt;p&gt;大家好，前陣子我開源了一個爲 34 鍵分體鍵盤（Ferris Sweep）量身打造的粵拼並擊輸入法（宮保粵拼），並做了一個可視化的 Web 模擬器（基於 Rust + Leptos）。上一期發佈後，視覺效果不錯，但在底層架構上，我遇到了一個經典的 Rust 難題：如何讓編譯期就固定的靜態數據，根據前端的 UI 狀態進行動態切換？&lt;&#x2F;p&gt;
&lt;h3 id=&quot;❌_痛點與挑戰&quot;&gt;❌ 痛點與挑戰&lt;&#x2F;h3&gt;
&lt;p&gt;在 Rime 引擎的架構思維中，輸入方案（包含幾百條正則拼寫運算規則）通常是非常重的，所以我們習慣將其放在 &lt;code&gt;lazy_static!&lt;&#x2F;code&gt; 裏，擁有 &lt;code&gt;&#x27;static&lt;&#x2F;code&gt; 生命週期。&lt;&#x2F;p&gt;
&lt;p&gt;但我的需求是：當用戶在前端下拉選單切換「實體鍵盤佈局」（如標準直列 -&amp;gt; 縱向錯列）時，底層的方案定義必須動態替換對應的指法規則。如果直接把前端的 &lt;code&gt;AppState&lt;&#x2F;code&gt; 塞進底層，會造成嚴重的耦合；如果每次切換都重新實例化整個方案，效能開銷又太大。&lt;&#x2F;p&gt;
&lt;h3 id=&quot;✅_解法：依賴注入_(DI)_+_函數指針_+_Leptos_細粒度響應式追蹤&quot;&gt;✅ 解法：依賴注入 (DI) + 函數指針 + Leptos 細粒度響應式追蹤&lt;&#x2F;h3&gt;
&lt;p&gt;經過一番折騰，我找到了一條非常優雅且符合 Rust 哲學的路徑：&lt;&#x2F;p&gt;</summary>
        
    </entry>
</feed>
